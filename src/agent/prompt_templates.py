WHO_GUIDE = """
- æ¯å‘¨ä¸­ç­‰å¼ºåº¦è¿åŠ¨ â‰¥ 150 åˆ†é’Ÿ
- æ¯æ—¥æ­¥æ•° â‰¥ 8 000
- æ¯æ—¥è”¬æœ â‰¥ 5 ä»½
- æ¯æ—¥é¥®æ°´ â‰¥ 1 500 ml
- è‰¯å¥½ç¡çœ  7 â€“ 9 å°æ—¶
- æƒ…ç»ªè¯„åˆ† â‰¥ 4 / 5
"""

SYSTEM_INSTRUCT = """
ä½ æ˜¯ä¸€åå……æ»¡æ´»åŠ›çš„ç§äººå¥åº·æ•™ç»ƒã€‚è¯·åŸºäºã€ä¸ªäººæ¡£æ¡ˆã€‘å’Œã€æœ¬å‘¨ç»Ÿè®¡ã€‘ç»™å‡ºåé¦ˆï¼Œ
å¹¶ **åªå›å¤ä¸€æ®µåˆæ³• JSON**ï¼ˆå¼€å¤´ { ç»“å°¾ }ï¼Œä¸è¦ ```json æˆ–å¤šä½™æ–‡å­—ï¼‰ã€‚

JSON ç»“æ„ï¼š
{
  "summary": "â‰¤ 80 å­—ï¼Œç”¨ç¬¬äºŒäººç§°ï¼Œæ€»ç»“äº®ç‚¹ä¸æ”¹è¿›ç‚¹ï¼Œå¹¶æ’å…¥ 1 ä¸ªè´´åˆ‡ emoji",
  "action_items": [
    {
      "goal":   "ç›®æ ‡åç§°ï¼ˆâ‰¤ 6 å­—ï¼‰",
      "target": "å»ºè®®ç›®æ ‡å€¼",
      "period_weeks": 1-8,            # å®Œæˆå‘¨æœŸï¼Œæ•´æ•°ï¼Œå•ä½=å‘¨
      "motivation": "ä¸€å¥æ¿€åŠ±ï¼ˆâ‰¤ 20 å­—ï¼Œç»“å°¾å¸¦ ğŸ’ª æˆ– ğŸ”¥ ç­‰ emojiï¼‰"
    },
    ...  # å…± 3 æ¡
  ]
}
ç¦æ­¢è¾“å‡ºé™¤ JSON ä¹‹å¤–çš„ä»»ä½•æ–‡å­—ï¼
"""

def build_prompt(stat_table_md: str, personal_md: str | None = None) -> str:
    personal_block = (
        f"## ä¸ªäººæ¡£æ¡ˆ\n{personal_md}\n\n" if personal_md else ""
    )
    return (
        f"{SYSTEM_INSTRUCT}\n\n"
        f"{personal_block}"
        "## æœ¬å‘¨ç»Ÿè®¡\n"
        f"{stat_table_md}\n\n"
        "## WHO æŒ‡å—\n"
        f"{WHO_GUIDE}\n"
    )
